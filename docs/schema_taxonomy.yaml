# Job Market Intelligence Platform - Taxonomy Schema
# Version: 1.6.0
# Last Updated: 2026-01-04
# Purpose: Define classification taxonomy for job postings in Product, Data, and Delivery roles
# Changes from v1.5.0: Added employer_industry taxonomy (18 domain-focused categories)

metadata:
  version: 1.6.0
  last_updated: "2026-01-04"
  scope: ["Product", "Data", "Delivery"]
  markets: ["London", "New York", "Denver", "San Francisco", "Singapore"]

  # Data sources (priority order for deduplication)
  data_sources:
    - {name: "Greenhouse", type: "scraper", companies: 302, description_quality: "full"}
    - {name: "Lever", type: "scraper", companies: 61, description_quality: "full"}
    - {name: "Adzuna", type: "api", description_quality: "truncated"}
  extraction_complexity:
    simple: [employer.name, role.title_display, location.city_code, posting.posted_date]
    moderate: [job_subfamily, skills.items.name, working_arrangement, position_type, seniority]
    complex: [experience_range, compensation.base_salary_range]
  data_availability:
    always: [title, company, location, url, posted_date]  # >95%
    usually: [skills, job_type, arrangement, department, seniority]  # 70-90%
    sometimes: [salary, experience_years]  # 30-50%
    rarely: [equity, headcount]  # <10%

# =========================
# FIELD DEFINITIONS (Output Schema)
# =========================
# These define the structured output after LLM classification
# LLM should return JSON matching this exact structure

fields:
  employer:
    name: 
      type: string
      required: true
      extraction_note: "Always present in job postings - exact company name"
    
    department: 
      type: enum
      enum: job_family
      nullable: true
      extraction_note: "Only if explicitly stated (e.g., 'Data team', 'Product org')"
    
    company_size_estimate: 
      type: enum
      enum: company_size
      nullable: true
      extraction_note: "Infer from context clues if clear (e.g., 'Series B startup', 'Fortune 500')"
    
    is_agency:
      type: boolean
      nullable: true
      extraction_note: "True if employer is recruitment agency/staffing firm posting on behalf of client. False if direct employer. Null if unclear. Agencies typically say 'our client', 'exciting opportunity', have 'Recruitment', 'Talent', 'Search' in name."
    
    agency_confidence:
      type: enum
      enum: confidence_level
      nullable: true
      extraction_note: "Confidence in is_agency classification. High = clear agency indicators, Medium = some indicators, Low = ambiguous."

  role:
    title_display: 
      type: string
      required: true
      extraction_note: "Exact title from posting - preserve original formatting"
    
    title_canonical: 
      type: string
      nullable: true
      extraction_note: "Normalized/standardized version using title_mappings (optional for LLM)"
    
    job_family:
      type: enum
      enum: job_family
      required: true
      extraction_note: "MUST classify as 'product', 'data', 'delivery', or 'out_of_scope' - never null. Use 'out_of_scope' for Software Engineering (including AI Engineers building apps), Marketing, Sales, Finance, etc."

    job_subfamily:
      type: enum
      enum: [product_subfamily, data_subfamily, delivery_subfamily]
      nullable: true
      extraction_note: "MUST choose specific subfamily from valid options. Set to null only if job_family is 'out_of_scope'. NOTE: Technical Project Manager routes to delivery family (project_manager), not Product."
    
    seniority:
      type: enum
      enum: seniority_level
      nullable: true
      extraction_note: "CRITICAL: Prioritize explicit title markers (Senior, Staff, Director) over years. Use years as secondary signal when title is ambiguous. See classification_guidance for detailed rules."
    
    track: 
      type: enum
      enum: track
      nullable: true
      extraction_note: "IC = individual contributor with no direct reports (includes tech/product leads). Management = explicit people management with direct reports, line management, or hiring/performance review responsibilities. When unclear or mentions 'team lead' without direct reports, default to IC."
    
    position_type: 
      type: enum
      enum: position_type
      required: true
      extraction_note: "Default to 'full_time' if not explicitly stated otherwise"
    
    experience_range: 
      type: string
      nullable: true
      extraction_note: "Only if explicitly stated (e.g., '3-5 years', '5+ years') - do NOT infer"

  location:
    city_code:
      type: enum
      enum: location_city
      required: true
      extraction_note: "Map location to one of: lon, nyc, den, sfo, sgp, remote, unk. Use 'remote' for WFH/remote-first jobs. Use 'unk' only if location truly cannot be determined."
    
    working_arrangement: 
      type: enum
      enum: working_arrangement
      required: true
      extraction_note: "Classify as onsite, hybrid, remote, or flexible. If job offers multiple options (e.g., 'remote or hybrid'), use 'flexible'. If not explicitly stated, default to 'onsite'."

  compensation:
    currency: 
      type: enum
      enum: currency_code
      nullable: true
      extraction_note: "Only if salary explicitly stated - infer from location if not specified"
    
    base_salary_range:
      type: object
      nullable: true
      properties:
        min: 
          type: number
          nullable: true
          extraction_note: "Minimum salary if range provided"
        max: 
          type: number
          nullable: true
          extraction_note: "Maximum salary if range provided"
      extraction_note: "Only extract if explicitly stated in posting - do NOT infer or estimate"
    
    equity_eligible: 
      type: boolean
      nullable: true
      extraction_note: "True if equity/stock options mentioned, null if not mentioned"

  skills:
    items:
      type: array
      extraction_note: "CRITICAL: Extract ONLY skills explicitly mentioned in posting text - NO inference"
      items:
        type: object
        properties:
          name: 
            type: string
            extraction_note: "Exact skill name from posting (e.g., 'Python', 'SQL', 'A/B testing')"
          
          family_code: 
            type: string
            nullable: true
            extraction_note: "Map to skill family from skills_ontology if match is clear"

  posting:
    posting_url: 
      type: string
      required: true
      extraction_note: "Full URL to job posting"
    
    source: 
      type: string
      required: true
      extraction_note: "Source identifier: 'greenhouse', 'lever', or 'adzuna'"
    
    req_id: 
      type: string
      nullable: true
      extraction_note: "Requisition/job ID if present in posting"
    
    posted_date: 
      type: string
      format: date
      required: true
      extraction_note: "Date job was posted (YYYY-MM-DD format)"
    
    last_seen_date: 
      type: string
      format: date
      required: true
      extraction_note: "Date job was last observed active (YYYY-MM-DD format)"
    
    is_sponsored: 
      type: boolean
      nullable: true
      extraction_note: "True if marked as sponsored/promoted, null if unclear"

# =========================
# ENUMS (Valid Values)
# =========================

enums:
  job_family:
    - {code: product, label: "Product", description: "Product management roles focused on strategy, roadmap, and user experience"}
    - {code: data, label: "Data", description: "Data and analytics roles including engineering, science, and analysis"}
    - {code: delivery, label: "Delivery", description: "Project delivery and agile roles focused on execution, timelines, and team facilitation"}
    - {code: out_of_scope, label: "Out of Scope", description: "Job is not Product, Data, or Delivery (e.g., Software Engineering, Marketing, Sales, Finance, Operations)"}

  location_city:
    - code: lon
      label: "London"
      description: "Greater London area, United Kingdom"
      region: "Greater London"
      country: "UK"
      country_code: "GB"
      default_currency: "GBP"
      aliases: ["London, UK", "London, England", "LON", "London, United Kingdom", "Greater London"]
    
    - code: nyc
      label: "New York"
      description: "New York City metro area, United States"
      region: "New York"
      country: "USA"
      country_code: "US"
      default_currency: "USD"
      aliases: ["New York, NY", "NYC", "New York City", "Manhattan", "Brooklyn", "Queens", "Bronx"]
    
    - code: den
      label: "Denver"
      description: "Denver metro area, Colorado, United States"
      region: "Colorado"
      country: "USA"
      country_code: "US"
      default_currency: "USD"
      aliases: ["Denver, CO", "DEN", "Denver Metro", "Boulder, CO", "Colorado"]

    - code: sfo
      label: "San Francisco"
      description: "San Francisco Bay Area, California, United States"
      region: "California"
      country: "USA"
      country_code: "US"
      default_currency: "USD"
      aliases: ["San Francisco, CA", "SFO", "SF", "Bay Area", "Silicon Valley", "Palo Alto", "Mountain View", "San Jose"]

    - code: sgp
      label: "Singapore"
      description: "Singapore city-state"
      region: "Singapore"
      country: "Singapore"
      country_code: "SG"
      default_currency: "SGD"
      aliases: ["Singapore", "SG", "SGP"]

    - code: remote
      label: "Remote"
      description: "Remote/work from home position, no specific office location"
      region: "N/A"
      country: "Various"
      country_code: "N/A"
      default_currency: null
      aliases: ["Remote", "WFH", "Work from Home", "Anywhere", "Remote - US", "Remote - UK", "Remote - EMEA", "Remote - Global"]

    - code: unk
      label: "Unknown"
      description: "Location could not be determined from job posting"
      region: "N/A"
      country: "N/A"
      country_code: "N/A"
      default_currency: null
      aliases: []

  working_arrangement:
    - {code: onsite, label: "Onsite", description: "Must work from office location full-time"}
    - {code: hybrid, label: "Hybrid", description: "Mix of office and remote work (e.g., 2-3 days office per week)"}
    - {code: remote, label: "Remote", description: "Work from home, remote-first, no office requirement"}
    - {code: flexible, label: "Flexible", description: "Multiple arrangements offered - employee can choose (remote OR hybrid OR onsite)"}
    - {code: unknown, label: "Unknown", description: "Working arrangement could not be determined from available data"}

  position_type:
    - {code: full_time, label: "Full Time", description: "Permanent, full-time employment (35-40 hours/week)"}
    - {code: part_time, label: "Part Time", description: "Permanent, part-time hours (<35 hours/week)"}
    - {code: contract, label: "Contract", description: "Fixed-term contract, contractor, temporary role"}
    - {code: internship, label: "Internship", description: "Temporary internship, co-op, or graduate program"}

  track:
    - {code: ic, label: "IC", description: "Individual contributor with no direct reports (includes tech leads and senior ICs)"}
    - {code: management, label: "Management", description: "People management with direct reports, hiring authority, performance reviews"}

  seniority_level:
    - {code: junior, label: "Junior", description: "Entry-level, 0-2 years experience, early career"}
    - {code: mid, label: "Mid-Level", description: "3-5 years experience, intermediate level, competent practitioner"}
    - {code: senior, label: "Senior", description: "6-10 years experience, lead-level individual contributor, domain expert"}
    - {code: staff_principal, label: "Staff/Principal", description: "11+ years, senior IC track (Staff Engineer, Principal PM, Distinguished Scientist)"}
    - {code: director_plus, label: "Director+", description: "Management track: Director, VP, SVP, Head of, C-level executive roles"}

  # Product subfamilies
  product_subfamily:
    - {code: core_pm, label: "Core PM", description: "General product management for user-facing features and products"}
    - {code: growth_pm, label: "Growth PM", description: "Focus on growth, acquisition, retention, monetization, conversion optimization"}
    - {code: platform_pm, label: "Platform PM", description: "Developer tools, APIs, infrastructure products, internal platforms"}
    - {code: technical_pm, label: "Technical PM", description: "Deep technical skills, often ex-engineer, works on complex technical products"}
    - {code: ai_ml_pm, label: "AI/ML PM", description: "AI/ML products, models, data products, machine learning features"}

  # Data subfamilies (ai_engineer REMOVED in v1.3)
  data_subfamily:
    - {code: product_analytics, label: "Product Analytics", description: "Product-focused analytics - metrics, experiments, user behavior, growth analytics"}
    - {code: data_analyst, label: "Data Analyst", description: "Business reporting, dashboards, SQL analysis, ad-hoc queries, BI tools"}
    - {code: analytics_engineer, label: "Analytics Engineer", description: "dbt, metrics layer, data modeling, semantic layer, SQL-focused transformations"}
    - {code: data_engineer, label: "Data Engineer", description: "Data pipelines, infrastructure, ETL/ELT, big data processing, Python/Scala"}
    - {code: ml_engineer, label: "Machine Learning Engineer", description: "Production ML systems, model deployment, MLOps - includes classical ML and GenAI/LLM work"}
    - {code: data_scientist, label: "Data Scientist", description: "Business insights, predictions, exploratory analysis, statistical modeling"}
    - {code: research_scientist_ml, label: "Research Scientist (ML/AI)", description: "Novel ML research, publications, cutting-edge techniques, pushing state-of-the-art"}
    - {code: data_architect, label: "Data Architect", description: "Data strategy, enterprise architecture design, data governance, platform design"}

  # Delivery subfamilies (added in v1.5.0)
  delivery_subfamily:
    - {code: delivery_manager, label: "Delivery Manager", description: "End-to-end delivery ownership, agile/waterfall delivery leadership, program execution"}
    - {code: project_manager, label: "Project Manager", description: "Traditional project management, timelines, budgets, stakeholder coordination, PRINCE2/PMP"}
    - {code: programme_manager, label: "Programme Manager", description: "Multi-project coordination, strategic initiatives, portfolio management, workstream oversight"}
    - {code: scrum_master, label: "Scrum Master", description: "Agile facilitation, sprint ceremonies, impediment removal, team coaching"}

  # Company size
  company_size:
    - {code: startup, label: "Startup (1-50)", description: "Small startup, 1-50 employees, early-stage"}
    - {code: scaleup, label: "Scale-up (51-500)", description: "Growth stage company, 51-500 employees, Series A-C"}
    - {code: enterprise, label: "Enterprise (500+)", description: "Large corporation, 500+ employees, established company"}

  # Employer industry (19 domain-focused categories)
  # Design decision: These are industry VERTICALS, not business models.
  # "B2B SaaS" was intentionally excluded - it's a business model that spans multiple industries.
  # A company like Stripe is "fintech" (not "b2b_saas") even though it sells B2B SaaS.
  employer_industry:
    - code: fintech
      label: "FinTech"
      description: "Tech-first financial disruptors - payments, neobanks, lending platforms, insurtech"
      signals: ["payments", "neobank", "digital bank", "lending platform", "insurtech", "fintech"]
      examples: ["Stripe", "Monzo", "Affirm", "Plaid", "Wise", "Revolut", "Brex"]

    - code: financial_services
      label: "Financial Services"
      description: "Traditional banks, insurers, asset managers, investment firms"
      signals: ["bank", "insurance company", "asset management", "investment bank", "hedge fund"]
      examples: ["JPMorgan", "Capital One", "Goldman Sachs", "BlackRock", "Citi", "HSBC"]

    - code: healthtech
      label: "HealthTech"
      description: "Digital health, biotech, pharma tech, medical devices, healthcare platforms"
      signals: ["health", "medical", "patient", "clinical", "pharma", "biotech", "care", "therapy"]
      examples: ["Flatiron Health", "Omada Health", "Oscar", "Tempus"]

    - code: ecommerce
      label: "E-commerce & Marketplace"
      description: "Online retail, marketplaces, delivery platforms, consumer commerce"
      signals: ["marketplace", "retail", "shopping", "delivery", "commerce", "logistics", "supply chain"]
      examples: ["Instacart", "DoorDash", "Deliveroo", "Etsy"]

    - code: ai_ml
      label: "AI/ML"
      description: "AI-first companies building foundation models, AI tools, or ML products"
      signals: ["artificial intelligence", "machine learning", "foundation model", "LLM", "generative ai", "ai-first"]
      examples: ["OpenAI", "Anthropic", "Harvey AI", "Cursor", "Runway"]

    - code: consumer
      label: "Consumer Tech"
      description: "Consumer apps, social media, entertainment, gaming, content platforms"
      signals: ["consumer", "social", "entertainment", "gaming", "content", "streaming", "media"]
      examples: ["Spotify", "Reddit", "Strava", "Peloton", "Discord"]

    - code: mobility
      label: "Mobility & Logistics"
      description: "Transportation, autonomous vehicles, logistics, fleet management"
      signals: ["mobility", "autonomous", "vehicle", "transportation", "fleet", "logistics", "shipping"]
      examples: ["Uber", "Waymo", "Zoox", "Wayve", "Zipline"]

    - code: proptech
      label: "PropTech"
      description: "Real estate technology, property management, home services"
      signals: ["real estate", "property", "home", "housing", "mortgage", "rental"]
      examples: ["Airbnb", "Zillow", "CoStar", "Rightmove"]

    - code: edtech
      label: "EdTech"
      description: "Education technology, learning platforms, training, upskilling"
      signals: ["education", "learning", "training", "course", "school", "university", "tutoring"]
      examples: ["Coursera", "Duolingo", "Guild Education", "Quizlet"]

    - code: climate
      label: "Climate Tech"
      description: "Clean energy, sustainability, carbon tracking, environmental tech"
      signals: ["climate", "sustainability", "carbon", "clean energy", "renewable", "environmental"]
      examples: ["Watershed", "Crusoe", "Yes Energy"]

    - code: crypto
      label: "Crypto & Web3"
      description: "Blockchain, cryptocurrency, DeFi, NFTs, web3 infrastructure"
      signals: ["crypto", "blockchain", "defi", "web3", "nft", "token", "chain"]
      examples: ["Coinbase", "Kraken", "OpenSea", "Alchemy"]

    - code: devtools
      label: "Developer Tools"
      description: "Developer productivity, IDEs, CI/CD, code collaboration, infrastructure tools"
      signals: ["developer", "IDE", "CI/CD", "code", "git", "devops", "infrastructure"]
      examples: ["GitHub", "Vercel", "Linear", "Retool", "Supabase"]

    - code: data_infra
      label: "Data Infrastructure"
      description: "Data platforms, analytics tools, data pipelines, business intelligence"
      signals: ["data platform", "analytics", "data warehouse", "ETL", "BI", "data pipeline"]
      examples: ["Snowflake", "Databricks", "dbt Labs", "Fivetran", "Dagster"]

    - code: cybersecurity
      label: "Cybersecurity"
      description: "Security software, identity management, compliance, threat detection"
      signals: ["security", "identity", "compliance", "threat", "authentication", "encryption"]
      examples: ["Okta", "Vanta", "1Password", "OneTrust"]

    - code: hr_tech
      label: "HR Tech"
      description: "HR software, payroll, workforce management, recruiting platforms"
      signals: ["HR", "payroll", "workforce", "recruiting", "talent", "employee", "benefits"]
      examples: ["Rippling", "Gusto", "Deel", "Lattice"]

    - code: martech
      label: "Marketing Tech"
      description: "Marketing automation, analytics, CRM, customer data platforms"
      signals: ["marketing", "CRM", "customer data", "analytics", "advertising", "email"]
      examples: ["Braze", "Amplitude", "HubSpot", "Mixpanel"]

    - code: professional_services
      label: "Professional Services"
      description: "Consulting, legal tech, accounting tech, business services"
      signals: ["consulting", "legal", "accounting", "advisory", "professional services"]
      examples: ["Deloitte", "Accenture", "PwC", "EY"]

    - code: hardware
      label: "Hardware & Robotics"
      description: "Hardware products, robotics, semiconductors, IoT devices"
      signals: ["hardware", "robotics", "semiconductor", "device", "sensor", "iot", "chip"]
      examples: ["Apple", "Gecko Robotics", "Cruise"]

    - code: other
      label: "Other"
      description: "Diversified conglomerates or industries not fitting above categories"
      signals: []
      examples: []

  # Skill parent families
  skill_parent:
    - {code: product, label: "Product", description: "Product management skills"}
    - {code: data_ml, label: "Data/ML", description: "Data science and machine learning skills"}
    - {code: delivery, label: "Delivery", description: "Project delivery and agile skills"}
    - {code: platform_infra, label: "Platform/Infra", description: "Platform and infrastructure skills"}

  # Currency codes
  currency_code:
    - {code: gbp, label: "GBP", description: "British Pound Sterling"}
    - {code: usd, label: "USD", description: "United States Dollar"}
    - {code: eur, label: "EUR", description: "Euro"}
    - {code: sgd, label: "SGD", description: "Singapore Dollar"}

  # Confidence levels
  confidence_level:
    - {code: high, label: "High", description: "High confidence classification"}
    - {code: medium, label: "Medium", description: "Medium confidence classification"}
    - {code: low, label: "Low", description: "Low confidence classification"}

# =========================
# SKILLS ONTOLOGY
# =========================
# No changes from v1.3 - LLM/GenAI skills retained as they're relevant to ML Engineers

skills_ontology:
  product:
    - family: {code: discovery_research, label: "Discovery & Research"}
      names: ["User interviews", "User research", "JTBD", "Jobs to be done", "Opportunity sizing", "Market research"]
    
    - family: {code: execution_delivery, label: "Execution & Delivery"}
      names: ["Backlog management", "Roadmapping", "Agile", "Scrum", "Kanban", "Prioritization", "JIRA", "Sprint planning", "Product strategy"]
    
    - family: {code: experimentation, label: "Experimentation"}
      names: ["A/B testing", "Experiment design", "Statistical significance", "Hypothesis testing", "Multivariate testing"]
    
    - family: {code: analytics_pm, label: "Analytics for PMs"}
      names: ["SQL", "Data analysis", "Metrics", "KPIs", "Dashboards", "Amplitude", "Mixpanel", "Google Analytics", "Product analytics"]

    - family: {code: stakeholder_mgmt, label: "Stakeholder Management"}
      names: ["Stakeholder management", "Executive communication", "Cross-functional collaboration", "Influence without authority"]

    - family: {code: business_tools, label: "Business Tools"}
      names: ["Excel", "PowerPoint", "Google Sheets", "Google Slides", "Microsoft Office", "MS Office", "Spreadsheets"]

    - family: {code: product_tools, label: "Product & Collaboration Tools"}
      names: ["Figma", "Sketch", "Miro", "Notion", "Confluence", "Asana", "Linear", "Productboard"]

  data_ml:
    - family: {code: programming, label: "Programming"}
      names: ["Python", "R", "SQL", "Scala", "Java", "Julia", "C++", "Rust", "Go"]
    
    - family: {code: analytics_stats, label: "Analytics/Statistics"}
      names: ["Statistics", "Probability", "Regression", "Causal inference", "Time series", "Hypothesis testing", "Bayesian analysis", "Experimentation"]
    
    - family: {code: classical_ml, label: "Classical Machine Learning"}
      names: ["Scikit-learn", "XGBoost", "LightGBM", "CatBoost", "Random Forest", "Logistic regression", "SVM", "Feature engineering", "Model training"]
    
    - family: {code: deep_learning, label: "Deep Learning"}
      names: ["PyTorch", "TensorFlow", "Keras", "JAX", "Neural networks", "CNNs", "RNNs", "Transformers", "Computer vision", "NLP"]
    
    - family: {code: llm_genai, label: "LLM/GenAI"}
      names: ["LLMs", "Large language models", "GPT", "BERT", "Claude", "Llama", "Prompt engineering", "RAG", "Retrieval augmented generation", "Vector databases", "LangChain", "LlamaIndex", "Embeddings", "Fine-tuning", "RLHF", "Agents", "Agentic AI"]
    
    - family: {code: big_data, label: "Big Data"}
      names: ["Spark", "PySpark", "Hadoop", "Hive", "Presto", "Trino", "Flink", "Distributed computing"]
    
    - family: {code: pipelines_orchestration, label: "Pipelines/Orchestration"}
      names: ["Airflow", "Dagster", "Prefect", "Luigi", "Data pipelines", "ETL", "ELT", "Workflow orchestration"]
    
    - family: {code: data_modeling, label: "Data Modeling"}
      names: ["dbt", "Data modeling", "Dimensional modeling", "Star schema", "Snowflake schema", "Data warehouse design", "Data vault"]
    
    - family: {code: warehouses_lakes, label: "Warehouses/Lakes"}
      names: ["Snowflake", "BigQuery", "Redshift", "Databricks", "Athena", "Delta Lake", "Data lake", "Lakehouse", "Iceberg"]

    - family: {code: databases, label: "Databases"}
      names: ["PostgreSQL", "Postgres", "MySQL", "MongoDB", "Redis", "Elasticsearch", "ElasticSearch", "Cassandra", "DynamoDB", "Neo4j", "Oracle", "SQL Server"]

    - family: {code: mlops, label: "MLOps"}
      names: ["MLflow", "Kubeflow", "Model serving", "Model monitoring", "Model deployment", "Feature stores", "Model registry", "Experiment tracking", "Weights & Biases"]
    
    - family: {code: cloud, label: "Cloud"}
      names: ["AWS", "GCP", "Google Cloud", "Azure", "S3", "EC2", "Lambda", "Cloud functions", "SageMaker", "Vertex AI"]
    
    - family: {code: streaming, label: "Streaming"}
      names: ["Kafka", "Kinesis", "Pub/Sub", "Real-time processing", "Stream processing", "Event-driven"]
    
    - family: {code: visualization, label: "Data Visualization"}
      names: ["Tableau", "Power BI", "Looker", "Metabase", "Superset", "Plotly", "Matplotlib", "Seaborn", "D3.js"]

  platform_infra:
    - family: {code: deployment, label: "Deployment"}
      names: ["Docker", "Kubernetes", "Helm", "Container orchestration", "K8s"]
    
    - family: {code: infrastructure_code, label: "Infrastructure as Code"}
      names: ["Terraform", "CloudFormation", "Pulumi", "Infrastructure automation", "IaC"]
    
    - family: {code: ci_cd, label: "CI/CD"}
      names: ["GitHub Actions", "Jenkins", "CircleCI", "GitLab CI", "ArgoCD", "Continuous integration", "Continuous deployment"]
    
    - family: {code: monitoring, label: "Monitoring/Observability"}
      names: ["Datadog", "New Relic", "Prometheus", "Grafana", "ELK stack", "Observability", "Logging", "Metrics"]

    - family: {code: version_control, label: "Version Control"}
      names: ["Git", "GitHub", "GitLab", "Bitbucket", "Version control", "GitOps", "GitHub Actions", "GitLab CI"]

    - family: {code: apis_integration, label: "APIs & Integration"}
      names: ["REST", "REST API", "GraphQL", "API", "APIs", "Webhooks", "FastAPI", "API Design", "Microservices", "gRPC", "OpenAPI"]

  delivery:
    - family: {code: methodologies, label: "Methodologies & Frameworks"}
      names: ["Agile", "Scrum", "Kanban", "SAFe", "Waterfall", "PRINCE2", "Lean", "Six Sigma", "Hybrid", "Agile methodology", "Scrum framework"]

    - family: {code: certifications, label: "Certifications"}
      names: ["PMP", "PRINCE2", "MSP", "CSM", "PSM", "PMI-ACP", "SAFe Agilist", "CAPM", "Scrum@Scale", "PgMP", "PMI-RMP"]

    - family: {code: delivery_tools, label: "Delivery Tools"}
      names: ["JIRA", "Confluence", "Asana", "Monday.com", "Trello", "MS Project", "Microsoft Project", "Smartsheet", "Azure DevOps", "Rally", "Planview"]

    - family: {code: governance, label: "Governance & Risk"}
      names: ["Risk management", "RAID log", "Change management", "Stakeholder management", "Budget management", "Resource planning", "Dependency management", "Issue management", "Capacity planning"]

# =========================
# CLASSIFICATION GUIDANCE
# =========================
# Critical rules for LLM classifier - read carefully before classifying

classification_guidance:
  agency_detection:
    high_confidence_indicators:
      - "Employer name contains: 'Recruitment', 'Recruiting', 'Talent', 'Staffing', 'Search', 'Headhunters', 'Solutions', 'Consulting', 'Partners', 'Associates'"
      - "Job description says: 'our client', 'on behalf of', 'exciting opportunity', 'leading company', 'confidential client'"
      - "Employer is known agency: Hays, Robert Half, Michael Page, Randstad, Adecco, Manpower, Harvey Nash"
    
    medium_confidence_indicators:
      - "Generic job description with minimal company details"
      - "Employer name ends with: Ltd, Limited, Group, International, Global (combined with recruitment terms)"
      - "CV submission instructions rather than application process"
    
    false_positives_to_avoid:
      - "Accenture Consulting, McKinsey - these are NOT recruitment agencies"
      - "Companies with 'Solutions' or 'Partners' in name are often legitimate tech companies"
      - "When in doubt, default to is_agency=false"

  seniority:
    priority_order:
      - "**Title is primary signal**: If title explicitly states level (Junior, Senior, Staff, Principal, Director), use that as primary classification"
      - "**Years as secondary signal**: Use experience years only when title is ambiguous (e.g., 'Data Scientist' without level qualifier)"
      - "**When both present**: If title and years conflict, prioritize title unless conflict is extreme (e.g., 'Junior' with 15 years)"
    
    year_boundary_rules:
      - "2 years exactly → junior (not mid)"
      - "3 years exactly → mid (not junior)"
      - "5 years exactly → mid (not senior)"
      - "6 years exactly → senior (not mid)"
      - "10 years exactly → senior (not staff_principal)"
      - "11 years exactly → staff_principal (not senior)"
      - "When years are borderline (e.g., '5-7 years'), use title as tiebreaker"
    
    title_priority_examples:
      - "'Senior Data Scientist, 4 years' → senior (title wins over years)"
      - "'Staff Engineer, 8 years' → staff_principal (title wins)"
      - "'Director of Data, 7 years' → director_plus (title wins)"
      - "'Data Scientist, 7 years' → senior (years guide when no level in title)"
      - "'Lead Data Scientist' → senior (Lead = senior level)"
      - "'Principal PM, 9 years' → staff_principal (title wins despite years suggesting senior)"
    
    market_context:
      - "UK Senior roles typically 6-8 years; US Senior roles typically 7-10 years"
      - "Both map to 'senior' classification for cross-market comparison"
      - "'Staff' and 'Principal' titles → staff_principal regardless of years stated"
      - "'Architect' roles → senior unless combined with 'Principal/Staff' (then staff_principal) or very senior (11+ years)"
    
    track_distinction:
      - "staff_principal = IC track (Staff Engineer, Principal PM, Distinguished Scientist)"
      - "director_plus = Management track (Director, VP, Head of, C-level)"
      - "These are parallel paths, not sequential - don't promote Staff to Director"
      - "Director with 8 years → director_plus (management track, ignore years)"
    
    edge_cases:
      - "Lead Engineer without years → senior (Lead = senior IC, not management)"
      - "Principal Engineer without years → staff_principal"
      - "Engineering Manager without years → senior (entry-level management)"
      - "Director without years → director_plus (management hierarchy)"
      - "Senior Engineer, 12+ years → senior (title wins, don't auto-promote to staff_principal)"
      - "'Architect' alone with 6-8 years → senior"
      - "'Principal Architect' → staff_principal"
      - "'5+ years' requirement → Use title to determine level (senior if title is Senior, mid if title is generic)"
    
    default_when_ambiguous: "mid"

  job_subfamily:
    critical_rules:
      - "ALWAYS classify jobs with 'Data Analyst' in title as data family, data_analyst subfamily - NEVER out_of_scope"
      - "ALWAYS classify jobs with 'Research Scientist' or 'Applied Scientist' in title as data family - see research_applied_scientist_routing"

    key_distinctions:
      - "Product Analytics vs Data Analyst: Product Analytics = product metrics, user behavior, in-product experimentation, feature analysis, growth analytics. Data Analyst = business reporting, dashboards, ad-hoc SQL analysis, BI tools."
      - "Analytics Engineer vs Data Engineer: Analytics Engineer = dbt, metrics layer, SQL-focused, data modeling, semantic layer. Data Engineer = pipelines, infrastructure, Python/Scala-focused, ETL/ELT, big data."
      - "Business Intelligence Engineer routing: Default to analytics_engineer (BI Engineers typically do data modeling, transformations, semantic layer work). Only use data_analyst if description clearly shows role is purely reporting/dashboards with no data modeling."
      - "ML Engineer scope (EXPANDED): Includes both classical ML (training models, feature engineering) AND GenAI/LLM work (fine-tuning, embeddings, RAG systems, agent frameworks) when focused on MODEL DEVELOPMENT. If role is primarily calling LLM APIs with minimal ML work, classify as out_of_scope (Software Engineering)."
      - "Data Scientist vs Research Scientist: Data Scientist = business insights, predictions, practical ML, stakeholder communication. Research Scientist = novel research, publications, cutting-edge techniques, pushing SOTA."
      - "Technical PM vs Platform PM: Technical PM = deep technical skills, often ex-engineer, technical architecture. Platform PM = developer tools, APIs, infrastructure products (may or may not be technical)."
    
    product_analytics_routing:
      - "Title 'Product Analyst' → Check job description:"
      - "  - If mentions: product metrics, user behavior, experimentation, A/B tests, feature analysis, growth → product_analytics"
      - "  - If mentions: business reporting, dashboards, SQL queries, BI tools, stakeholder reports → data_analyst"
      - "Title 'Product Analytics' → Always product_analytics"
      - "Title 'Growth Analyst' → Usually product_analytics (growth is product-adjacent)"
    
    ml_engineer_vs_software_engineer:
      - "AI Engineer title → Classify as out_of_scope UNLESS description clearly involves:"
      - "  - Training/fine-tuning ML models"
      - "  - Building ML pipelines or MLOps infrastructure"
      - "  - Research on model architectures"
      - "  - Feature engineering or data science workflows"
      - "If AI Engineer role is primarily: API integration, prompt engineering without model work, backend development → out_of_scope"
      - "If ML Engineer role involves LLMs, RAG, embeddings, fine-tuning → ml_engineer (legitimate ML work)"

    product_engineer_disambiguation:
      - "CRITICAL: 'Product Engineer' is a SOFTWARE ENGINEERING role, NOT a Product Manager role"
      - "'Product Engineer' = Software Engineer who builds user-facing product features → out_of_scope"
      - "'Platform Engineer' = Software Engineer who builds internal platforms → out_of_scope"
      - "'Product Manager' = Strategy, roadmap, user experience owner → product family"
      - "The word 'Product' in 'Product Engineer' refers to what they BUILD, not what they MANAGE"
      - "Even 'Staff Product Engineer, AI' is engineering - they code, not manage products"

    research_applied_scientist_routing:
      - "CRITICAL: Research Scientist and Applied Scientist titles are ALWAYS data family roles, never out_of_scope"
      - "Applied Scientist → research_scientist_ml (applied ML research, model development, algorithm design)"
      - "Research Scientist (ML/AI/Data focus) → research_scientist_ml"
      - "Research Scientist (non-ML focus like physics, chemistry) → out_of_scope"
      - "Staff/Principal Applied Scientist → research_scientist_ml with staff_principal seniority"
      - "Embodied AI, Robotics ML, Foundation Models, Computer Vision, NLP research → ALL are research_scientist_ml"

  working_arrangement:
    classification_rules:
      - "If posting says 'remote OR hybrid OR onsite' → flexible"
      - "If posting says 'hybrid (2 days office)' → hybrid"
      - "If posting says 'remote-first with quarterly offsites' → remote"
      - "If nothing stated → onsite (default)"
      - "If says 'remote within [region]' → remote (not flexible)"
      - "CRITICAL: Look for phrases at END of job description - working arrangement often specified in final paragraphs"

  delivery_subfamily:
    critical_rules:
      - "ALWAYS classify 'Project Manager' as delivery family - NEVER product (unless title is 'Product Manager')"
      - "ALWAYS classify 'Technical Project Manager' as delivery family, project_manager subfamily - NOT technical_pm in Product"
      - "ALWAYS classify 'Programme Manager' or 'Program Manager' as delivery family"

    key_distinctions:
      - "Delivery Manager vs Project Manager: Delivery Manager = ongoing delivery ownership, continuous delivery; Project Manager = discrete project timelines, defined start/end"
      - "Programme Manager vs Project Manager: Programme Manager = multiple projects/workstreams, strategic portfolio; Project Manager = single project focus"
      - "Technical Project Manager vs Technical Product Manager: TPjM = technical execution/delivery, coordinates engineering; TPM = technical product strategy, roadmap ownership"
      - "Project Manager vs Product Manager: Project Manager = execution/delivery, timelines, budgets; Product Manager = strategy, roadmap, user experience"
      - "Scrum Master vs Delivery Manager: Scrum Master = team-level agile facilitation, ceremonies; Delivery Manager = broader delivery ownership, may span multiple teams"

    routing_rules:
      - "Title 'Project Manager' → delivery family, project_manager"
      - "Title 'Technical Project Manager' → delivery family, project_manager"
      - "Title 'Programme Manager' or 'Program Manager' → delivery family, programme_manager"
      - "Title 'Delivery Manager' or 'Delivery Lead' → delivery family, delivery_manager"
      - "Title 'Scrum Master' → delivery family, scrum_master"
      - "Title 'Agile Coach' or 'Iteration Manager' → delivery family, scrum_master (agile facilitation)"
      - "Title 'Release Manager' → delivery family, delivery_manager"
      - "Title 'PMO Manager/Lead/Director' → delivery family, programme_manager"
      - "Title 'Agile Delivery Manager' → delivery family, delivery_manager"

# =========================
# NORMALIZATION HELPERS
# =========================
# Used for post-processing and data cleaning

normalization:
  title_mappings:
    # Product mappings
    "PM": "Product Manager"
    "Sr PM": "Senior Product Manager"
    "Sr. PM": "Senior Product Manager"
    "Product Owner": "Product Manager"
    "PO": "Product Manager"
    "TPM": "Technical Product Manager"
    "AI Product Manager": "AI/ML Product Manager"
    "ML Product Manager": "AI/ML Product Manager"
    "Product Analyst": "Product Analytics"  # New mapping
    
    # Data mappings
    "DE": "Data Engineer"
    "Sr DE": "Senior Data Engineer"
    "Sr. DE": "Senior Data Engineer"
    "MLE": "Machine Learning Engineer"
    "ML Engineer": "Machine Learning Engineer"
    "DS": "Data Scientist"
    "Sr DS": "Senior Data Scientist"
    "Sr. DS": "Senior Data Scientist"
    "Applied Scientist": "Research Scientist (ML/AI)"  # Applied science roles are ML research
    "Research Scientist": "Research Scientist (ML/AI)"
    "Analytics Eng": "Analytics Engineer"
    "BI Developer": "Business Intelligence Engineer"
    "BI Engineer": "Business Intelligence Engineer"
    "BI Analyst": "Data Analyst"
    "Business Intelligence Analyst": "Data Analyst"
    "Business Intelligence Engineer": "Business Intelligence Engineer"  # Classify based on job description (see classification_guidance)

    # Delivery mappings
    "PM": "Project Manager"  # Ambiguous - context determines if Product or Project
    "PgM": "Programme Manager"
    "Program Manager": "Programme Manager"
    "Technical PM": "Technical Project Manager"  # Routes to delivery, not product
    "TPjM": "Technical Project Manager"
    "SM": "Scrum Master"
    "Scrum Master": "Scrum Master"
    "Delivery Lead": "Delivery Manager"
    "PMO Lead": "PMO Manager"
    "PMO Director": "PMO Manager"

  seniority_markers:
    junior: 
      - "junior"
      - "jr"
      - "jr."
      - "entry"
      - "entry-level"
      - "graduate"
      - "early career"
      - "0-2 years"
      - "0-3 years"
      - "I"
      - "associate"
    
    mid: 
      - "mid"
      - "mid-level"
      - "intermediate"
      - "II"
      - "3-5 years"
      - "3-4 years"
      - "4-5 years"
    
    senior: 
      - "senior"
      - "sr"
      - "sr."
      - "lead"
      - "III"
      - "6+ years"
      - "7+ years"
      - "6-10 years"
      - "architect"  # when standalone without principal/staff modifier
    
    staff_principal: 
      - "staff"
      - "principal"
      - "distinguished"
      - "fellow"
      - "IV"
      - "V"
      - "11+ years"
      - "staff engineer"
      - "principal engineer"
      - "staff pm"
      - "principal pm"
      - "principal architect"
      - "staff architect"
      - "staff data scientist"
      - "principal data scientist"
    
    director_plus:
      - "director"
      - "senior director"
      - "vp"
      - "vice president"
      - "svp"
      - "head of"
      - "chief"
      - "cto"
      - "cpo"
      - "cdo"
      - "evp"

# =========================
# VALIDATION RULES
# =========================
# Applied after classification to ensure data quality

validation:
  - rule: "salary_min_less_than_max"
    check: "compensation.base_salary_range.min <= compensation.base_salary_range.max"
    severity: error
  
  - rule: "valid_date_sequence"
    check: "posting.posted_date <= posting.last_seen_date"
    severity: error
  
  - rule: "job_family_subfamily_match"
    check: "if role.job_family == 'product' then role.job_subfamily in product_subfamily"
    severity: error
  
  - rule: "job_family_subfamily_match_data"
    check: "if role.job_family == 'data' then role.job_subfamily in data_subfamily"
    severity: error

  - rule: "job_family_subfamily_match_delivery"
    check: "if role.job_family == 'delivery' then role.job_subfamily in delivery_subfamily"
    severity: error

  - rule: "out_of_scope_has_null_subfamily"
    check: "if role.job_family == 'out_of_scope' then role.job_subfamily is null"
    severity: error

  - rule: "location_currency_match_uk"
    check: "if location.city_code == 'lon' then compensation.currency in ['gbp', null]"
    severity: warning

  - rule: "location_currency_match_us"
    check: "if location.city_code in ['nyc', 'den', 'sfo'] then compensation.currency in ['usd', null]"
    severity: warning

  - rule: "location_currency_match_sg"
    check: "if location.city_code == 'sgp' then compensation.currency in ['sgd', null]"
    severity: warning
  
  - rule: "ai_engineer_removed"
    check: "role.job_subfamily != 'ai_engineer'"
    severity: error
    message: "ai_engineer removed in v1.3 - classify as ml_engineer or out_of_scope"

# =========================
# DEDUPLICATION STRATEGY
# =========================
# Used in data pipeline to identify duplicate postings

deduplication:
  hash_fields: [employer.name, role.title_display, location.city_code]
  similarity_threshold: 0.85  # For fuzzy matching of descriptions
  time_window_days: 30  # Consider same job if posted within this window
  notes: "Jobs are considered duplicates if they have matching company, title, and location within 30-day window"